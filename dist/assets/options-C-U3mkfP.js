import{c as A,j as o,r as f}from"./client-BCr4-QWM.js";const j=[{text:"Work",emoji:"ðŸ’¼",color:"#7e22ce"},{text:"Finance",emoji:"ðŸ’°",color:"#22c55e"},{text:"Hobbies",emoji:"ðŸŽ¨",color:"#facc15"},{text:"Spirituality",emoji:"ðŸ§˜",color:"#22d3ee"},{text:"Health",emoji:"ðŸ‹ï¸",color:"#ef4444"},{text:"Social Media",emoji:"ðŸ’¬",color:"#ff6347"},{text:"Community",emoji:"ðŸ¤",color:"#a259ff"},{text:"Entertainment",emoji:"ðŸŽ¬",color:"#eab308"},{text:"Shopping",emoji:"ðŸ›’",color:"#38bdf8"},{text:"News",emoji:"ðŸ“°",color:"#64748b"},{text:"Travel",emoji:"âœˆï¸",color:"#f472b6"},{text:"Misc",emoji:"â“",color:"#d1d5db"}];function H(){const[F,M]=f.useState({}),[w,k]=f.useState({description:"",categories:j}),[N,v]=f.useState(!1),[G,O]=f.useState([]),[D,z]=f.useState(!1),[R,C]=f.useState("");f.useEffect(()=>{chrome.storage.local.get(["db","profile","historyPaused","debugMode","debugDate","selectedCategories"],r=>{M(r.db||{}),k(r.profile||{description:"",categories:j}),v(!!r.historyPaused),z(!!r.debugMode),C(r.debugDate||""),O(r.selectedCategories||j.map(n=>typeof n=="string"?n:n.text))})},[]);const $=()=>{const r=!D;z(r),chrome.storage.local.set({debugMode:r}),r||(C(""),chrome.storage.local.remove("debugDate"))},E=r=>{C(r.target.value),chrome.storage.local.set({debugDate:r.target.value})},B=()=>{chrome.storage.local.set({profile:w},async()=>{await x(!1)})},I=()=>{chrome.storage.local.remove("profile",async()=>{k({description:"",categories:j}),await x(!0)})};async function W(r){return new Promise(n=>chrome.storage.local.get(r,n))}async function P(r){return new Promise(n=>chrome.storage.local.set(r,n))}async function L(){x(!1);const{db:r,profile:n}=await W(["db","profile"]),a={perDay:{},totalSeconds:0,totalMinutes:0,totalTabs:0,highestDay:null,highestMinutes:0,categoryTotals:{},categoryPercents:[],topCategoryWebsites:{}};let b=0,y=0,S=null,m=0;const g={};for(const e of Object.keys(r||{})){let t=0,i=0;for(const l of Object.values(r[e]||{}))t+=l.time||0,i+=l.count||0,l.category&&(g[l.category]||(g[l.category]=0),g[l.category]+=l.time||0);a.perDay[e]={seconds:t,minutes:Math.floor(t/60),tabs:i},b+=t,y+=i,t/60>m&&(m=Math.floor(t/60),S=e)}a.totalSeconds=b,a.totalMinutes=Math.floor(b/60),a.totalTabs=y,a.highestDay=S,a.highestMinutes=m,a.categoryTotals=g,a.categoryPercents=Object.entries(g).map(([e,t])=>({cat:e,sec:t,hrs:Math.round(t/3600),pct:b?t/b*100:0})).sort((e,t)=>t.sec-e.sec);const d=a.categoryPercents.slice(0,5).map(e=>e.cat),p={};for(const e of d)p[e]=[];for(const e of Object.keys(r||{}))for(const[t,i]of Object.entries(r[e]||{}))d.includes(i.category)&&p[i.category].push({title:i.title||t,time:i.time||0,url:t});a.categorySummaries={};for(const e of d){p[e]=p[e].sort((t,i)=>i.time-t.time).slice(0,100),a.topCategoryWebsites[e]=p[e].map(t=>t.title),console.log("Top pages for category",e,":",a.topCategoryWebsites[e]);try{console.log("Summarizing category:",e);const t=await window.Summarizer.create({type:"tldr",format:"plain-text",length:"short",sharedContext:`Summarize the user's behavior in the category '${e}' from the following top 100 pages. Strictly keep it under 100 words.`}),i=p[e].map((c,s)=>`${s+1}. ${c.title} (${c.time} seconds)`).join(`
`),h=`User description: ${n?.description||""}
Top 100 pages in category '${e}':
${i}`,u=await t.summarize(h);a.categorySummaries[e]=u}catch(t){console.log("Error summarizing category",e,":",t),a.categorySummaries[e]="Summary unavailable."}}a.topCategoryStreaks={};for(const e of d){if(e==="Misc / Uncategorized"||e==="miscellaneous")continue;let t=[];const i={};for(const u of Object.keys(r||{})){let c=0;for(const s of Object.values(r[u]||{}))s.category===e&&(c+=s.time||0);i[u]=c}const l=Object.keys(i).sort();let h=[];if(l.length>0){const u=new Date(l[l.length-1]);for(let s=6;s>=0;s--){const T=new Date(u);T.setDate(T.getDate()-s),h.push(T.toISOString().slice(0,10))}t=h.map(s=>({date:s,minutes:i[s]||0})).map(s=>({date:s.date,seconds:s.minutes}))}else{const u=new Date;for(let c=6;c>=0;c--){const s=new Date(u);s.setDate(s.getDate()-c),h.push(s.toISOString().slice(0,10))}t=h.map(c=>({date:c,seconds:0}))}a.topCategoryStreaks[e]=t,console.log(`Streak for ${e}:`,t)}await P({tabWrapSummary:a}),console.log("Tab Wrap summary calculated!")}async function x(r=!1){const{db:n,profile:a}=await W(["db","profile"]);if(!window.LanguageModel){console.log("LanguageModel API not available");return}if(await LanguageModel.availability()==="unavailable"){console.log("Gemini Nano not available");return}const y=await LanguageModel.create(),S=a?.description||"",m=(a?.categories||[]).map(d=>typeof d=="string"?d:d.text);let g=!1;for(const d of Object.keys(n||{}))for(const[p,e]of Object.entries(n[d]||{}))if(r||!e.category){console.log("Checking entry for URL:",p,"Current category:",e.category);const t=`User description: ${S}
Categories: ${m.join(", ")}
URL: ${p}
Title: ${e.title}

Based on the above, which category was the user spending time on?
Strictly output only one category from the list above. If none match, output 'miscellaneous'.`;console.log("Asking model with prompt:",t);try{const i=await y.prompt(t);e.category=i.trim(),g=!0}catch{e.category="error",g=!0}}y.destroy(),g?await P({db:n}):console.log("No entries found.")}return o.jsxs("div",{style:{minHeight:"100vh",padding:32,background:"#111",boxSizing:"border-box",position:"relative",fontFamily:"Inter, Arial, sans-serif",display:"flex",justifyContent:"center",alignItems:"flex-start"},children:[o.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:0,pointerEvents:"none"},children:[o.jsx("div",{style:{position:"absolute",top:40,left:60,width:220,height:220,background:"radial-gradient(circle, #ff2d55 0%, transparent 70%)",filter:"blur(40px)",opacity:.7}}),o.jsx("div",{style:{position:"absolute",top:120,right:40,width:180,height:180,background:"radial-gradient(circle, #a259ff 0%, transparent 70%)",filter:"blur(40px)",opacity:.6}}),o.jsx("div",{style:{position:"absolute",bottom:40,left:120,width:160,height:160,background:"radial-gradient(circle, #2ecc40 0%, transparent 70%)",filter:"blur(40px)",opacity:.5}})]}),o.jsxs("div",{style:{maxWidth:700,width:"100%"},children:[o.jsx("h2",{style:{color:"#fff",fontWeight:800,fontSize:36,letterSpacing:1,marginBottom:18,textAlign:"center",textShadow:"0 2px 12px #a259ff, 0 1px 4px #ff2d55"},children:"Tab Wrap Options"}),o.jsxs("div",{style:{marginBottom:24},children:[o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:D,onChange:$})," Debug Mode"]}),D&&o.jsxs("div",{style:{marginTop:8},children:[o.jsx("label",{children:"Set Debug Date: "}),o.jsx("input",{type:"date",value:R,onChange:E,style:{marginLeft:8}})]})]}),o.jsxs("div",{style:{margin:"24px 0",background:"transparent",borderRadius:18,padding:20,color:"#fff",boxShadow:"0 4px 16px rgba(0,0,0,0.15)"},children:[o.jsx("label",{style:{fontWeight:"bold",fontSize:20,marginBottom:12,display:"block",letterSpacing:1},children:"Tell us about yourself:"}),o.jsx("textarea",{value:w.description,onChange:r=>k({...w,description:r.target.value}),style:{width:"100%",minHeight:60,background:"transparent",color:"#fff",border:"none",fontSize:16,fontFamily:"inherit",outline:"none",resize:"vertical"},placeholder:"Share a bit about your work, interests, or browsing habits..."})]}),o.jsxs("div",{style:{marginTop:32},children:[o.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap",marginBottom:18},children:[o.jsx("button",{style:{background:"white",color:"rgb(255, 90, 46)",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(46,204,64,0.12)",cursor:"pointer"},onClick:B,children:"Save Profile"}),o.jsx("button",{style:{background:"white",color:"rgb(255, 90, 46)",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(162,89,255,0.12)",cursor:"pointer"},onClick:I,children:"Clear Profile"}),o.jsx("button",{style:{background:"white",color:"rgb(255, 90, 46)",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(79,140,255,0.12)",cursor:"pointer"},onClick:()=>x(!1),children:"Categorize"}),o.jsx("button",{style:{background:"white",color:"rgb(255, 90, 46)",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(255,45,85,0.12)",cursor:"pointer"},onClick:L,children:"Tab Wrap"})]}),o.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap",marginTop:18},children:[o.jsx("button",{style:{background:"linear-gradient(90deg, #232526 0%, #414345 100%)",color:"#fff",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(0,0,0,0.12)",cursor:"pointer"},onClick:()=>chrome.storage.local.set({db:{}},()=>M({})),children:"Clear DB"}),o.jsx("button",{style:{background:"linear-gradient(90deg, #232526 0%, #ff2d55 100%)",color:"#fff",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(255,45,85,0.12)",cursor:"pointer"},onClick:()=>chrome.storage.local.set({historyPaused:!0},()=>v(!0)),children:"Pause History"}),o.jsx("button",{style:{background:"linear-gradient(90deg, #232526 0%, #2ecc40 100%)",color:"#fff",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(46,204,64,0.12)",cursor:"pointer"},onClick:()=>chrome.storage.local.set({historyPaused:!1},()=>v(!1)),children:"Resume History"})]})]}),o.jsx("div",{style:{marginTop:32,display:"flex",justifyContent:"center"},children:o.jsx("button",{style:{background:"linear-gradient(90deg, #ff2d55 0%, #232526 100%)",color:"#fff",border:"none",borderRadius:12,padding:"12px 32px",fontWeight:700,fontSize:18,boxShadow:"0 2px 8px rgba(255,45,85,0.18)",cursor:"pointer",marginTop:24},onClick:()=>window.location.href="test_page.html",children:"Go to Test Page"})})]})]})}const U=document.getElementById("root");A.createRoot(U).render(o.jsx(H,{}));
