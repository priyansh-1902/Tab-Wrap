import{c as A,j as t,r as b}from"./client-BCr4-QWM.js";const h=[{text:"Work",emoji:"ðŸ’¼",color:"#7e22ce"},{text:"Finance",emoji:"ðŸ’°",color:"#22c55e"},{text:"Hobbies",emoji:"ðŸŽ¨",color:"#facc15"},{text:"Spirituality",emoji:"ðŸ§˜",color:"#22d3ee"},{text:"Health",emoji:"ðŸ‹ï¸",color:"#ef4444"},{text:"Social Media",emoji:"ðŸ’¬",color:"#ff6347"},{text:"Community",emoji:"ðŸ¤",color:"#a259ff"},{text:"Entertainment",emoji:"ðŸŽ¬",color:"#eab308"},{text:"Shopping",emoji:"ðŸ›’",color:"#38bdf8"},{text:"News",emoji:"ðŸ“°",color:"#64748b"},{text:"Travel",emoji:"âœˆï¸",color:"#f472b6"},{text:"Misc",emoji:"â“",color:"#d1d5db"}];function U(){const[N,k]=b.useState({}),[x,j]=b.useState({description:"",categories:h}),[G,S]=b.useState(!1),[y,C]=b.useState([]),[w,W]=b.useState(!1),[M,v]=b.useState("");b.useEffect(()=>{chrome.storage.local.get(["db","profile","historyPaused","debugMode","debugDate","selectedCategories"],e=>{k(e.db||{}),j(e.profile||{description:"",categories:h}),S(!!e.historyPaused),W(!!e.debugMode),v(e.debugDate||""),C(e.selectedCategories||h.map(i=>typeof i=="string"?i:i.text))})},[]);const P=e=>{let i=typeof e=="string"?e:e.text,r;y.includes(i)?r=y.filter(n=>n!==i):r=[...y,i],C(r),chrome.storage.local.set({selectedCategories:r})},R=()=>{const e=!w;W(e),chrome.storage.local.set({debugMode:e}),e||(v(""),chrome.storage.local.remove("debugDate"))},$=e=>{v(e.target.value),chrome.storage.local.set({debugDate:e.target.value})},E=()=>{chrome.storage.local.set({profile:x},async()=>{await m(!1)})},B=()=>{chrome.storage.local.remove("profile",async()=>{j({description:"",categories:h}),await m(!0)})};async function z(e){return new Promise(i=>chrome.storage.local.get(e,i))}async function T(e){return new Promise(i=>chrome.storage.local.set(e,i))}async function O(){m(!1);const{db:e,profile:i}=await z(["db","profile"]),r={perDay:{},totalSeconds:0,totalMinutes:0,totalTabs:0,highestDay:null,highestMinutes:0,categoryTotals:{},categoryPercents:[],topCategoryWebsites:{}};let n=0,l=0,f=null,u=0;const c={};for(const o of Object.keys(e||{})){let a=0,s=0;for(const p of Object.values(e[o]||{}))a+=p.time||0,s+=p.count||0,p.category&&(c[p.category]||(c[p.category]=0),c[p.category]+=p.time||0);r.perDay[o]={seconds:a,minutes:Math.floor(a/60),tabs:s},n+=a,l+=s,a/60>u&&(u=Math.floor(a/60),f=o)}r.totalSeconds=n,r.totalMinutes=Math.floor(n/60),r.totalTabs=l,r.highestDay=f,r.highestMinutes=u,r.categoryTotals=c,r.categoryPercents=Object.entries(c).map(([o,a])=>({cat:o,sec:a,hrs:Math.round(a/3600),pct:n?a/n*100:0})).sort((o,a)=>a.sec-o.sec);const d=r.categoryPercents.slice(0,5).map(o=>o.cat),g={};for(const o of d)g[o]=[];for(const o of Object.keys(e||{}))for(const[a,s]of Object.entries(e[o]||{}))d.includes(s.category)&&g[s.category].push({title:s.title||a,time:s.time||0,url:a});r.categorySummaries={};for(const o of d){g[o]=g[o].sort((a,s)=>s.time-a.time).slice(0,100),r.topCategoryWebsites[o]=g[o].map(a=>a.title),console.log("Top pages for category",o,":",r.topCategoryWebsites[o]);try{console.log("Summarizing category:",o);const a=await window.Summarizer.create({type:"tldr",format:"plain-text",length:"short",sharedContext:`Summarize the user's behavior in the category '${o}' from the following top 100 pages. Strictly keep it under 100 words.`}),s=g[o].map((D,H)=>`${H+1}. ${D.title} (${D.time} seconds)`).join(`
`),I=`User description: ${i?.description||""}
Top 100 pages in category '${o}':
${s}`,L=await a.summarize(I);r.categorySummaries[o]=L}catch(a){console.log("Error summarizing category",o,":",a),r.categorySummaries[o]="Summary unavailable."}}await T({tabWrapSummary:r}),console.log("Tab Wrap summary calculated!")}async function m(e=!1){const{db:i,profile:r}=await z(["db","profile"]);if(!window.LanguageModel){console.log("LanguageModel API not available");return}if(await LanguageModel.availability()==="unavailable"){console.log("Gemini Nano not available");return}const l=await LanguageModel.create(),f=r?.description||"",u=(r?.categories||[]).map(d=>typeof d=="string"?d:d.text);let c=!1;for(const d of Object.keys(i||{}))for(const[g,o]of Object.entries(i[d]||{}))if(e||!o.category){console.log("Checking entry for URL:",g,"Current category:",o.category);const a=`User description: ${f}
Categories: ${u.join(", ")}
URL: ${g}
Title: ${o.title}

Based on the above, which category was the user spending time on?
Strictly output only one category from the list above. If none match, output 'miscellaneous'.`;console.log("Asking model with prompt:",a);try{const s=await l.prompt(a);o.category=s.trim(),c=!0}catch{o.category="error",c=!0}}l.destroy(),c?await T({db:i}):console.log("No entries found.")}return t.jsxs("div",{style:{minHeight:"100vh",padding:32,background:"#111",boxSizing:"border-box",position:"relative",fontFamily:"Inter, Arial, sans-serif",display:"flex",justifyContent:"center",alignItems:"flex-start"},children:[t.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:0,pointerEvents:"none"},children:[t.jsx("div",{style:{position:"absolute",top:40,left:60,width:220,height:220,background:"radial-gradient(circle, #ff2d55 0%, transparent 70%)",filter:"blur(40px)",opacity:.7}}),t.jsx("div",{style:{position:"absolute",top:120,right:40,width:180,height:180,background:"radial-gradient(circle, #a259ff 0%, transparent 70%)",filter:"blur(40px)",opacity:.6}}),t.jsx("div",{style:{position:"absolute",bottom:40,left:120,width:160,height:160,background:"radial-gradient(circle, #2ecc40 0%, transparent 70%)",filter:"blur(40px)",opacity:.5}})]}),t.jsxs("div",{style:{maxWidth:700,width:"100%"},children:[t.jsx("h2",{style:{color:"#fff",fontWeight:800,fontSize:36,letterSpacing:1,marginBottom:18,textAlign:"center",textShadow:"0 2px 12px #a259ff, 0 1px 4px #ff2d55"},children:"Tab Wrap Options"}),t.jsxs("div",{style:{marginBottom:24},children:[t.jsxs("label",{children:[t.jsx("input",{type:"checkbox",checked:w,onChange:R})," Debug Mode"]}),w&&t.jsxs("div",{style:{marginTop:8},children:[t.jsx("label",{children:"Set Debug Date: "}),t.jsx("input",{type:"date",value:M,onChange:$,style:{marginLeft:8}})]})]}),t.jsxs("div",{style:{margin:"24px 0",background:"transparent",borderRadius:18,padding:20,color:"#fff",boxShadow:"0 4px 16px rgba(0,0,0,0.15)"},children:[t.jsx("label",{style:{fontWeight:"bold",fontSize:20,marginBottom:12,display:"block",letterSpacing:1},children:"Tell us about yourself:"}),t.jsx("textarea",{value:x.description,onChange:e=>j({...x,description:e.target.value}),style:{width:"100%",minHeight:60,background:"transparent",color:"#fff",border:"none",fontSize:16,fontFamily:"inherit",outline:"none",resize:"vertical"},placeholder:"Share a bit about your work, interests, or browsing habits..."})]}),t.jsxs("div",{style:{margin:"24px 0",background:"transparent",borderRadius:18,padding:20,color:"#fff",boxShadow:"0 4px 16px rgba(0,0,0,0.15)"},children:[t.jsx("label",{style:{fontWeight:"bold",fontSize:20,marginBottom:12,display:"block",letterSpacing:1},children:"Categories (click to select):"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"14px"},children:x.categories.map((e,i)=>{let r="",n="";if(typeof e=="string"){const f=h.find(u=>u.text===e);r=f?f.emoji:"",n=e}else r=e.emoji,n=e.text;const l=y.includes(n);return t.jsxs("span",{onClick:()=>P(e),style:{background:l?"#fff":"#f3f3f3",color:l?"#222":"#444",borderRadius:14,padding:"10px 18px",fontSize:17,display:"flex",alignItems:"center",boxShadow:l?"0 2px 12px rgba(0,0,0,0.10)":"0 2px 8px rgba(0,0,0,0.08)",border:l?"2px solid #4f8cff":"1px solid #eee",minWidth:90,justifyContent:"center",cursor:"pointer",opacity:l?1:.85,transition:"all 0.2s",userSelect:"none",fontWeight:l?600:400,letterSpacing:.5},title:l?"Included in analytics":"Excluded from analytics",children:[r&&t.jsx("span",{style:{fontSize:24,marginRight:10},children:r}),n]},n+i)})})]}),t.jsxs("div",{style:{marginTop:32},children:[t.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap",marginBottom:18},children:[t.jsx("button",{style:{background:"white",color:"rgb(255, 90, 46)",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(46,204,64,0.12)",cursor:"pointer"},onClick:E,children:"Save Profile"}),t.jsx("button",{style:{background:"white",color:"rgb(255, 90, 46)",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(162,89,255,0.12)",cursor:"pointer"},onClick:B,children:"Clear Profile"}),t.jsx("button",{style:{background:"white",color:"rgb(255, 90, 46)",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(79,140,255,0.12)",cursor:"pointer"},onClick:()=>m(!1),children:"Categorize"}),t.jsx("button",{style:{background:"white",color:"rgb(255, 90, 46)",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(255,45,85,0.12)",cursor:"pointer"},onClick:O,children:"Tab Wrap"})]}),t.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap",marginTop:18},children:[t.jsx("button",{style:{background:"linear-gradient(90deg, #232526 0%, #414345 100%)",color:"#fff",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(0,0,0,0.12)",cursor:"pointer"},onClick:()=>chrome.storage.local.set({db:{}},()=>k({})),children:"Clear DB"}),t.jsx("button",{style:{background:"linear-gradient(90deg, #232526 0%, #ff2d55 100%)",color:"#fff",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(255,45,85,0.12)",cursor:"pointer"},onClick:()=>chrome.storage.local.set({historyPaused:!0},()=>S(!0)),children:"Pause History"}),t.jsx("button",{style:{background:"linear-gradient(90deg, #232526 0%, #2ecc40 100%)",color:"#fff",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(46,204,64,0.12)",cursor:"pointer"},onClick:()=>chrome.storage.local.set({historyPaused:!1},()=>S(!1)),children:"Resume History"})]})]}),t.jsx("div",{style:{marginTop:32,display:"flex",justifyContent:"center"},children:t.jsx("button",{style:{background:"linear-gradient(90deg, #ff2d55 0%, #232526 100%)",color:"#fff",border:"none",borderRadius:12,padding:"12px 32px",fontWeight:700,fontSize:18,boxShadow:"0 2px 8px rgba(255,45,85,0.18)",cursor:"pointer",marginTop:24},onClick:()=>window.location.href="test_page.html",children:"Go to Test Page"})})]})]})}const F=document.getElementById("root");A.createRoot(F).render(t.jsx(U,{}));
