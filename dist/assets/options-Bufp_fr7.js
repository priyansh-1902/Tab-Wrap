import{c as _,j as o,r as m}from"./client-DUeHcXHK.js";const k=[{text:"Work and Learning",emoji:"ðŸ’¼"},{text:"Finance",emoji:"ðŸ’°"},{text:"Hobbies / Creativity",emoji:"ðŸŽ¨"},{text:"Spirituality",emoji:"ðŸ§˜"},{text:"Health / Fitness",emoji:"ðŸ‹ï¸"},{text:"Social Media / Messaging",emoji:"ðŸ’¬"},{text:"Community / Volunteering",emoji:"ðŸ¤"},{text:"Entertainment / Gaming",emoji:"ðŸŽ¬"},{text:"Shopping",emoji:"ðŸ›’"},{text:"News",emoji:"ðŸ“°"},{text:"Travel",emoji:"âœˆï¸"},{text:"Misc / Uncategorized",emoji:"â“"}];function q(){const[K,R]=m.useState({}),[v,z]=m.useState({description:"",categories:k}),[Q,M]=m.useState(!1),[C,O]=m.useState([]),[T,L]=m.useState(!1),[I,P]=m.useState("");m.useEffect(()=>{chrome.storage.local.get(["db","profile","historyPaused","debugMode","debugDate","selectedCategories"],e=>{R(e.db||{}),z(e.profile||{description:"",categories:k}),M(!!e.historyPaused),L(!!e.debugMode),P(e.debugDate||""),O(e.selectedCategories||k.map(i=>typeof i=="string"?i:i.text))})},[]);const B=e=>{let i=typeof e=="string"?e:e.text,r;C.includes(i)?r=C.filter(s=>s!==i):r=[...C,i],O(r),chrome.storage.local.set({selectedCategories:r})},H=()=>{const e=!T;L(e),chrome.storage.local.set({debugMode:e}),e||(P(""),chrome.storage.local.remove("debugDate"))},A=e=>{P(e.target.value),chrome.storage.local.set({debugDate:e.target.value})},U=()=>{chrome.storage.local.set({profile:v},async()=>{await D(!0)})},F=()=>{chrome.storage.local.remove("profile",async()=>{z({description:"",categories:k}),await D(!0)})};async function $(e){return new Promise(i=>chrome.storage.local.get(e,i))}async function E(e){return new Promise(i=>chrome.storage.local.set(e,i))}async function G(){D(!1);const{db:e,profile:i}=await $(["db","profile"]),r={perDay:{},totalSeconds:0,totalMinutes:0,totalTabs:0,highestDay:null,highestMinutes:0,categoryTotals:{},categoryPercents:[],topCategoryWebsites:{}};let s=0,l=0,b=null,h=0;const g={};for(const t of Object.keys(e||{})){let a=0,n=0;for(const c of Object.values(e[t]||{}))a+=c.time||0,n+=c.count||0,c.category&&(g[c.category]||(g[c.category]=0),g[c.category]+=c.time||0);r.perDay[t]={seconds:a,minutes:Math.floor(a/60),tabs:n},s+=a,l+=n,a/60>h&&(h=Math.floor(a/60),b=t)}r.totalSeconds=s,r.totalMinutes=Math.floor(s/60),r.totalTabs=l,r.highestDay=b,r.highestMinutes=h,r.categoryTotals=g,r.categoryPercents=Object.entries(g).map(([t,a])=>({cat:t,sec:a,hrs:Math.round(a/3600),pct:s?a/s*100:0})).sort((t,a)=>a.sec-t.sec);const p=r.categoryPercents.slice(0,5).map(t=>t.cat),u={};for(const t of p)u[t]=[];for(const t of Object.keys(e||{}))for(const[a,n]of Object.entries(e[t]||{}))p.includes(n.category)&&u[n.category].push({title:n.title||a,time:n.time||0,url:a});r.categorySummaries={};for(const t of p){u[t]=u[t].sort((a,n)=>n.time-a.time).slice(0,100),r.topCategoryWebsites[t]=u[t].map(a=>a.title),console.log("Top pages for category",t,":",r.topCategoryWebsites[t]);try{console.log("Summarizing category:",t);const a=await window.Summarizer.create({type:"tldr",format:"plain-text",length:"short",sharedContext:`Summarize the user's behavior in the category '${t}' from the following top 100 pages. Strictly keep it under 100 words.`}),n=u[t].map((j,w)=>`${w+1}. ${j.title} (${j.time} seconds)`).join(`
`),y=`User description: ${i?.description||""}
Top 100 pages in category '${t}':
${n}`,S=await a.summarize(y);r.categorySummaries[t]=S}catch(a){console.log("Error summarizing category",t,":",a),r.categorySummaries[t]="Summary unavailable."}}let f=g["Work and Professional"]!==void 0?"Work and Professional":g["Work and Learning"]!==void 0?"Work and Learning":null,x=[];if(f){const t={};for(const n of Object.keys(e||{})){let c=0;for(const y of Object.values(e[n]||{}))y.category===f&&(c+=Math.floor((y.time||0)/60));t[n]=c}const a=Object.keys(t).sort();if(a.length>0){const n=new Date(a[0]),c=new Date(a[a.length-1]),y=[];for(let d=new Date(n);d<=c;d.setDate(d.getDate()+1)){const W=d.toISOString().slice(0,10);y.push(W)}const S=y.map(d=>({date:d,minutes:t[d]||0}));let j=-1,w=0;for(let d=0;d<=S.length-7;d++){const W=S.slice(d,d+7).reduce((N,V)=>N+V.minutes,0);W>j&&(j=W,w=d)}x=S.slice(w,w+7)}else x=[];r.workStreak=x,console.log("workStreak:",x)}else r.workStreak=[];await E({tabWrapSummary:r}),console.log("Tab Wrap summary calculated!")}async function D(e=!1){const{db:i,profile:r}=await $(["db","profile"]);if(!window.LanguageModel){console.log("LanguageModel API not available");return}if(await LanguageModel.availability()==="unavailable"){console.log("Gemini Nano not available");return}const l=await LanguageModel.create(),b=r?.description||"",h=(r?.categories||[]).map(p=>typeof p=="string"?p:p.text);let g=!1;for(const p of Object.keys(i||{}))for(const[u,f]of Object.entries(i[p]||{}))if(e||!f.category){console.log("Checking entry for URL:",u,"Current category:",f.category);const x=`User description: ${b}
Categories: ${h.join(", ")}
URL: ${u}
Title: ${f.title}

Based on the above, which category was the user spending time on?
Strictly output only one category from the list above. If none match, output 'miscellaneous'.`;console.log("Asking model with prompt:",x);try{const t=await l.prompt(x);f.category=t.trim(),g=!0}catch{f.category="error",g=!0}}l.destroy(),g?await E({db:i}):console.log("No entries found.")}return o.jsxs("div",{style:{minHeight:"100vh",padding:32,background:"#111",boxSizing:"border-box",position:"relative",fontFamily:"Inter, Arial, sans-serif",display:"flex",justifyContent:"center",alignItems:"flex-start"},children:[o.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:0,pointerEvents:"none"},children:[o.jsx("div",{style:{position:"absolute",top:40,left:60,width:220,height:220,background:"radial-gradient(circle, #ff2d55 0%, transparent 70%)",filter:"blur(40px)",opacity:.7}}),o.jsx("div",{style:{position:"absolute",top:120,right:40,width:180,height:180,background:"radial-gradient(circle, #a259ff 0%, transparent 70%)",filter:"blur(40px)",opacity:.6}}),o.jsx("div",{style:{position:"absolute",bottom:40,left:120,width:160,height:160,background:"radial-gradient(circle, #2ecc40 0%, transparent 70%)",filter:"blur(40px)",opacity:.5}})]}),o.jsxs("div",{style:{maxWidth:700,width:"100%"},children:[o.jsx("h2",{style:{color:"#fff",fontWeight:800,fontSize:36,letterSpacing:1,marginBottom:18,textAlign:"center",textShadow:"0 2px 12px #a259ff, 0 1px 4px #ff2d55"},children:"Tab Wrap Options"}),o.jsxs("div",{style:{marginBottom:24},children:[o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:T,onChange:H})," Debug Mode"]}),T&&o.jsxs("div",{style:{marginTop:8},children:[o.jsx("label",{children:"Set Debug Date: "}),o.jsx("input",{type:"date",value:I,onChange:A,style:{marginLeft:8}})]})]}),o.jsxs("div",{style:{margin:"24px 0",background:"transparent",borderRadius:18,padding:20,color:"#fff",boxShadow:"0 4px 16px rgba(0,0,0,0.15)"},children:[o.jsx("label",{style:{fontWeight:"bold",fontSize:20,marginBottom:12,display:"block",letterSpacing:1},children:"Tell us about yourself:"}),o.jsx("textarea",{value:v.description,onChange:e=>z({...v,description:e.target.value}),style:{width:"100%",minHeight:60,background:"transparent",color:"#fff",border:"none",fontSize:16,fontFamily:"inherit",outline:"none",resize:"vertical"},placeholder:"Share a bit about your work, interests, or browsing habits..."})]}),o.jsxs("div",{style:{margin:"24px 0",background:"transparent",borderRadius:18,padding:20,color:"#fff",boxShadow:"0 4px 16px rgba(0,0,0,0.15)"},children:[o.jsx("label",{style:{fontWeight:"bold",fontSize:20,marginBottom:12,display:"block",letterSpacing:1},children:"Categories (click to select):"}),o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"14px"},children:v.categories.map((e,i)=>{let r="",s="";if(typeof e=="string"){const b=k.find(h=>h.text===e);r=b?b.emoji:"",s=e}else r=e.emoji,s=e.text;const l=C.includes(s);return o.jsxs("span",{onClick:()=>B(e),style:{background:l?"#fff":"#f3f3f3",color:l?"#222":"#444",borderRadius:14,padding:"10px 18px",fontSize:17,display:"flex",alignItems:"center",boxShadow:l?"0 2px 12px rgba(0,0,0,0.10)":"0 2px 8px rgba(0,0,0,0.08)",border:l?"2px solid #4f8cff":"1px solid #eee",minWidth:90,justifyContent:"center",cursor:"pointer",opacity:l?1:.85,transition:"all 0.2s",userSelect:"none",fontWeight:l?600:400,letterSpacing:.5},title:l?"Included in analytics":"Excluded from analytics",children:[r&&o.jsx("span",{style:{fontSize:24,marginRight:10},children:r}),s]},s+i)})})]}),o.jsxs("div",{style:{marginTop:32},children:[o.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap",marginBottom:18},children:[o.jsx("button",{style:{background:"white",color:"rgb(255, 90, 46)",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(46,204,64,0.12)",cursor:"pointer"},onClick:U,children:"Save Profile"}),o.jsx("button",{style:{background:"white",color:"rgb(255, 90, 46)",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(162,89,255,0.12)",cursor:"pointer"},onClick:F,children:"Clear Profile"}),o.jsx("button",{style:{background:"white",color:"rgb(255, 90, 46)",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(79,140,255,0.12)",cursor:"pointer"},onClick:()=>D(!1),children:"Categorize"}),o.jsx("button",{style:{background:"white",color:"rgb(255, 90, 46)",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(255,45,85,0.12)",cursor:"pointer"},onClick:G,children:"Tab Wrap"})]}),o.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap",marginTop:18},children:[o.jsx("button",{style:{background:"linear-gradient(90deg, #232526 0%, #414345 100%)",color:"#fff",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(0,0,0,0.12)",cursor:"pointer"},onClick:()=>chrome.storage.local.set({db:{}},()=>R({})),children:"Clear DB"}),o.jsx("button",{style:{background:"linear-gradient(90deg, #232526 0%, #ff2d55 100%)",color:"#fff",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(255,45,85,0.12)",cursor:"pointer"},onClick:()=>chrome.storage.local.set({historyPaused:!0},()=>M(!0)),children:"Pause History"}),o.jsx("button",{style:{background:"linear-gradient(90deg, #232526 0%, #2ecc40 100%)",color:"#fff",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(46,204,64,0.12)",cursor:"pointer"},onClick:()=>chrome.storage.local.set({historyPaused:!1},()=>M(!1)),children:"Resume History"})]})]}),o.jsx("div",{style:{marginTop:32,display:"flex",justifyContent:"center"},children:o.jsx("button",{style:{background:"linear-gradient(90deg, #ff2d55 0%, #232526 100%)",color:"#fff",border:"none",borderRadius:12,padding:"12px 32px",fontWeight:700,fontSize:18,boxShadow:"0 2px 8px rgba(255,45,85,0.18)",cursor:"pointer",marginTop:24},onClick:()=>window.location.href="test_page.html",children:"Go to Test Page"})})]})]})}const J=document.getElementById("root");_.createRoot(J).render(o.jsx(q,{}));
