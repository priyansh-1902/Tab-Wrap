import{c as J,j as t,r as y}from"./client-DUeHcXHK.js";const C=[{text:"Work and Learning",emoji:"ðŸ’¼"},{text:"Finance",emoji:"ðŸ’°"},{text:"Hobbies / Creativity",emoji:"ðŸŽ¨"},{text:"Spirituality",emoji:"ðŸ§˜"},{text:"Health / Fitness",emoji:"ðŸ‹ï¸"},{text:"Social Media / Messaging",emoji:"ðŸ’¬"},{text:"Community / Volunteering",emoji:"ðŸ¤"},{text:"Entertainment / Gaming",emoji:"ðŸŽ¬"},{text:"Shopping",emoji:"ðŸ›’"},{text:"News",emoji:"ðŸ“°"},{text:"Travel",emoji:"âœˆï¸"},{text:"Misc / Uncategorized",emoji:"â“"}];function K(){const[X,I]=y.useState({}),[v,P]=y.useState({description:"",categories:C}),[Y,R]=y.useState(!1),[D,$]=y.useState([]),[O,L]=y.useState(!1),[U,E]=y.useState("");y.useEffect(()=>{chrome.storage.local.get(["db","profile","historyPaused","debugMode","debugDate","selectedCategories"],e=>{I(e.db||{}),P(e.profile||{description:"",categories:C}),R(!!e.historyPaused),L(!!e.debugMode),E(e.debugDate||""),$(e.selectedCategories||C.map(n=>typeof n=="string"?n:n.text))})},[]);const A=e=>{let n=typeof e=="string"?e:e.text,r;D.includes(n)?r=D.filter(c=>c!==n):r=[...D,n],$(r),chrome.storage.local.set({selectedCategories:r})},F=()=>{const e=!O;L(e),chrome.storage.local.set({debugMode:e}),e||(E(""),chrome.storage.local.remove("debugDate"))},G=e=>{E(e.target.value),chrome.storage.local.set({debugDate:e.target.value})},N=()=>{chrome.storage.local.set({profile:v},async()=>{await T(!0)})},V=()=>{chrome.storage.local.remove("profile",async()=>{P({description:"",categories:C}),await T(!0)})};async function B(e){return new Promise(n=>chrome.storage.local.get(e,n))}async function H(e){return new Promise(n=>chrome.storage.local.set(e,n))}async function _(){T(!1);const{db:e,profile:n}=await B(["db","profile"]),r={perDay:{},totalSeconds:0,totalMinutes:0,totalTabs:0,highestDay:null,highestMinutes:0,categoryTotals:{},categoryPercents:[],topCategoryWebsites:{},workCategoryTotals:{},workStreak:[]};let c=0,d=0,h=null,x=0;const p={},l={};for(const o of Object.keys(e||{})){let a=0,i=0,b=0;for(const g of Object.values(e[o]||{}))a+=g.time||0,i+=g.count||0,g.category&&(p[g.category]||(p[g.category]=0),p[g.category]+=g.time||0,g.category.toLowerCase().includes("work")&&(b+=g.time||0));r.perDay[o]={seconds:a,minutes:Math.floor(a/60),tabs:i},l[o]=Math.floor(b/60),c+=a,d+=i,a/60>x&&(x=Math.floor(a/60),h=o)}r.totalSeconds=c,r.totalMinutes=Math.floor(c/60),r.totalTabs=d,r.highestDay=h,r.highestMinutes=x,r.categoryTotals=p,r.workCategoryTotals=l,r.categoryPercents=Object.entries(p).map(([o,a])=>({cat:o,sec:a,hrs:Math.round(a/3600),pct:c?a/c*100:0})).sort((o,a)=>a.sec-o.sec);const u=Object.keys(l).sort();new Set(u);let f=u.length?u[0]:null,m=u.length?u[u.length-1]:null;if(f&&m){let o=[],a=new Date(m);for(let s=-6;s<=0;s++){let j=new Date(a);j.setDate(j.getDate()+s);let W=j.toISOString().slice(0,10);o.push(W)}o.forEach(s=>{l[s]||(l[s]=0)});let i=[],b=new Date(f),g=new Date(m);for(;b<=g;)i.push(b.toISOString().slice(0,10)),b.setDate(b.getDate()+1);for(;i.length<7;){let s=new Date(f);s.setDate(s.getDate()-(7-i.length)),i.unshift(s.toISOString().slice(0,10))}i.forEach(s=>{l[s]||(l[s]=0)});let z=-1,k=[];for(let s=0;s<=i.length-7;s++){let j=i.slice(s,s+7),W=j.reduce((M,q)=>M+(l[q]||0),0);W>z&&(z=W,k=j.map(M=>({date:M,minutes:l[M]||0})))}r.workStreak=k}const S=r.categoryPercents.slice(0,5).map(o=>o.cat),w={};for(const o of S)w[o]=[];for(const o of Object.keys(e||{}))for(const[a,i]of Object.entries(e[o]||{}))S.includes(i.category)&&w[i.category].push({title:i.title||a,time:i.time||0,url:a});r.categorySummaries={};for(const o of S){w[o]=w[o].sort((a,i)=>i.time-a.time).slice(0,100),r.topCategoryWebsites[o]=w[o].map(a=>a.title),console.log("Top pages for category",o,":",r.topCategoryWebsites[o]);try{console.log("Summarizing category:",o);const a=await window.Summarizer.create({type:"tldr",format:"plain-text",length:"short",sharedContext:`Summarize the user's behavior in the category '${o}' from the following top 100 pages. Strictly keep it under 100 words.`}),i=w[o].map((k,s)=>`${s+1}. ${k.title} (${k.time} seconds)`).join(`
`),g=`User description: ${n?.description||""}
Top 100 pages in category '${o}':
${i}`,z=await a.summarize(g);r.categorySummaries[o]=z}catch(a){console.log("Error summarizing category",o,":",a),r.categorySummaries[o]="Summary unavailable."}}await H({tabWrapSummary:r}),console.log("Tab Wrap summary calculated!")}async function T(e=!1){const{db:n,profile:r}=await B(["db","profile"]);if(!window.LanguageModel){console.log("LanguageModel API not available");return}if(await LanguageModel.availability()==="unavailable"){console.log("Gemini Nano not available");return}const d=await LanguageModel.create(),h=r?.description||"",x=(r?.categories||[]).map(l=>typeof l=="string"?l:l.text);let p=!1;for(const l of Object.keys(n||{}))for(const[u,f]of Object.entries(n[l]||{}))if(e||!f.category){console.log("Checking entry for URL:",u,"Current category:",f.category);const m=`User description: ${h}
Categories: ${x.join(", ")}
URL: ${u}
Title: ${f.title}

Based on the above, which category was the user spending time on?
Strictly output only one category from the list above. If none match, output 'miscellaneous'.`;console.log("Asking model with prompt:",m);try{const S=await d.prompt(m);f.category=S.trim(),p=!0}catch{f.category="error",p=!0}}d.destroy(),p?await H({db:n}):console.log("No entries found.")}return t.jsxs("div",{style:{minHeight:"100vh",padding:32,background:"#111",boxSizing:"border-box",position:"relative",fontFamily:"Inter, Arial, sans-serif",display:"flex",justifyContent:"center",alignItems:"flex-start"},children:[t.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:0,pointerEvents:"none"},children:[t.jsx("div",{style:{position:"absolute",top:40,left:60,width:220,height:220,background:"radial-gradient(circle, #ff2d55 0%, transparent 70%)",filter:"blur(40px)",opacity:.7}}),t.jsx("div",{style:{position:"absolute",top:120,right:40,width:180,height:180,background:"radial-gradient(circle, #a259ff 0%, transparent 70%)",filter:"blur(40px)",opacity:.6}}),t.jsx("div",{style:{position:"absolute",bottom:40,left:120,width:160,height:160,background:"radial-gradient(circle, #2ecc40 0%, transparent 70%)",filter:"blur(40px)",opacity:.5}})]}),t.jsxs("div",{style:{maxWidth:700,width:"100%"},children:[t.jsx("h2",{style:{color:"#fff",fontWeight:800,fontSize:36,letterSpacing:1,marginBottom:18,textAlign:"center",textShadow:"0 2px 12px #a259ff, 0 1px 4px #ff2d55"},children:"Tab Wrap Options"}),t.jsxs("div",{style:{marginBottom:24},children:[t.jsxs("label",{children:[t.jsx("input",{type:"checkbox",checked:O,onChange:F})," Debug Mode"]}),O&&t.jsxs("div",{style:{marginTop:8},children:[t.jsx("label",{children:"Set Debug Date: "}),t.jsx("input",{type:"date",value:U,onChange:G,style:{marginLeft:8}})]})]}),t.jsxs("div",{style:{margin:"24px 0",background:"transparent",borderRadius:18,padding:20,color:"#fff",boxShadow:"0 4px 16px rgba(0,0,0,0.15)"},children:[t.jsx("label",{style:{fontWeight:"bold",fontSize:20,marginBottom:12,display:"block",letterSpacing:1},children:"Tell us about yourself:"}),t.jsx("textarea",{value:v.description,onChange:e=>P({...v,description:e.target.value}),style:{width:"100%",minHeight:60,background:"transparent",color:"#fff",border:"none",fontSize:16,fontFamily:"inherit",outline:"none",resize:"vertical"},placeholder:"Share a bit about your work, interests, or browsing habits..."})]}),t.jsxs("div",{style:{margin:"24px 0",background:"transparent",borderRadius:18,padding:20,color:"#fff",boxShadow:"0 4px 16px rgba(0,0,0,0.15)"},children:[t.jsx("label",{style:{fontWeight:"bold",fontSize:20,marginBottom:12,display:"block",letterSpacing:1},children:"Categories (click to select):"}),t.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"14px"},children:v.categories.map((e,n)=>{let r="",c="";if(typeof e=="string"){const h=C.find(x=>x.text===e);r=h?h.emoji:"",c=e}else r=e.emoji,c=e.text;const d=D.includes(c);return t.jsxs("span",{onClick:()=>A(e),style:{background:d?"#fff":"#f3f3f3",color:d?"#222":"#444",borderRadius:14,padding:"10px 18px",fontSize:17,display:"flex",alignItems:"center",boxShadow:d?"0 2px 12px rgba(0,0,0,0.10)":"0 2px 8px rgba(0,0,0,0.08)",border:d?"2px solid #4f8cff":"1px solid #eee",minWidth:90,justifyContent:"center",cursor:"pointer",opacity:d?1:.85,transition:"all 0.2s",userSelect:"none",fontWeight:d?600:400,letterSpacing:.5},title:d?"Included in analytics":"Excluded from analytics",children:[r&&t.jsx("span",{style:{fontSize:24,marginRight:10},children:r}),c]},c+n)})})]}),t.jsxs("div",{style:{marginTop:32},children:[t.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap",marginBottom:18},children:[t.jsx("button",{style:{background:"white",color:"rgb(255, 90, 46)",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(46,204,64,0.12)",cursor:"pointer"},onClick:N,children:"Save Profile"}),t.jsx("button",{style:{background:"white",color:"rgb(255, 90, 46)",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(162,89,255,0.12)",cursor:"pointer"},onClick:V,children:"Clear Profile"}),t.jsx("button",{style:{background:"white",color:"rgb(255, 90, 46)",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(79,140,255,0.12)",cursor:"pointer"},onClick:()=>T(!1),children:"Categorize"}),t.jsx("button",{style:{background:"white",color:"rgb(255, 90, 46)",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(255,45,85,0.12)",cursor:"pointer"},onClick:_,children:"Tab Wrap"})]}),t.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap",marginTop:18},children:[t.jsx("button",{style:{background:"linear-gradient(90deg, #232526 0%, #414345 100%)",color:"#fff",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(0,0,0,0.12)",cursor:"pointer"},onClick:()=>chrome.storage.local.set({db:{}},()=>I({})),children:"Clear DB"}),t.jsx("button",{style:{background:"linear-gradient(90deg, #232526 0%, #ff2d55 100%)",color:"#fff",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(255,45,85,0.12)",cursor:"pointer"},onClick:()=>chrome.storage.local.set({historyPaused:!0},()=>R(!0)),children:"Pause History"}),t.jsx("button",{style:{background:"linear-gradient(90deg, #232526 0%, #2ecc40 100%)",color:"#fff",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(46,204,64,0.12)",cursor:"pointer"},onClick:()=>chrome.storage.local.set({historyPaused:!1},()=>R(!1)),children:"Resume History"})]})]}),t.jsx("div",{style:{marginTop:32,display:"flex",justifyContent:"center"},children:t.jsx("button",{style:{background:"linear-gradient(90deg, #ff2d55 0%, #232526 100%)",color:"#fff",border:"none",borderRadius:12,padding:"12px 32px",fontWeight:700,fontSize:18,boxShadow:"0 2px 8px rgba(255,45,85,0.18)",cursor:"pointer",marginTop:24},onClick:()=>window.location.href="test_page.html",children:"Go to Test Page"})})]})]})}const Q=document.getElementById("root");J.createRoot(Q).render(t.jsx(K,{}));
