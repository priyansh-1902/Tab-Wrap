import{c as q,j as r,r as b}from"./client-BCr4-QWM.js";const S=[{text:"Work",emoji:"ðŸ’¼"},{text:"Finance",emoji:"ðŸ’°"},{text:"Hobbies",emoji:"ðŸŽ¨"},{text:"Spirituality",emoji:"ðŸ§˜"},{text:"Health",emoji:"ðŸ‹ï¸"},{text:"Social Media ",emoji:"ðŸ’¬"},{text:"Community",emoji:"ðŸ¤"},{text:"Entertainment",emoji:"ðŸŽ¬"},{text:"Shopping",emoji:"ðŸ›’"},{text:"News",emoji:"ðŸ“°"},{text:"Travel",emoji:"âœˆï¸"},{text:"Misc",emoji:"â“"}];function J(){const[Q,P]=b.useState({}),[C,D]=b.useState({description:"",categories:S}),[V,z]=b.useState(!1),[j,R]=b.useState([]),[M,O]=b.useState(!1),[I,W]=b.useState("");b.useEffect(()=>{chrome.storage.local.get(["db","profile","historyPaused","debugMode","debugDate","selectedCategories"],t=>{P(t.db||{}),D(t.profile||{description:"",categories:S}),z(!!t.historyPaused),O(!!t.debugMode),W(t.debugDate||""),R(t.selectedCategories||S.map(s=>typeof s=="string"?s:s.text))})},[]);const L=t=>{let s=typeof t=="string"?t:t.text,a;j.includes(s)?a=j.filter(d=>d!==s):a=[...j,s],R(a),chrome.storage.local.set({selectedCategories:a})},B=()=>{const t=!M;O(t),chrome.storage.local.set({debugMode:t}),t||(W(""),chrome.storage.local.remove("debugDate"))},H=t=>{W(t.target.value),chrome.storage.local.set({debugDate:t.target.value})},A=()=>{chrome.storage.local.set({profile:C},async()=>{await w(!0)})},F=()=>{chrome.storage.local.remove("profile",async()=>{D({description:"",categories:S}),await w(!0)})};async function $(t){return new Promise(s=>chrome.storage.local.get(t,s))}async function U(t){return new Promise(s=>chrome.storage.local.set(t,s))}async function N(){w(!1);const{db:t,profile:s}=await $(["db","profile"]);for(const e of Object.keys(t||{}))for(const[o,i]of Object.entries(t[e]||{}))i.category&&i.category.toLowerCase().startsWith("misc")&&delete t[e][o];const a={perDay:{},totalSeconds:0,totalMinutes:0,totalTabs:0,highestDay:null,highestMinutes:0,categoryTotals:{},categoryPercents:[],topCategoryWebsites:{}};let d=0,c=0,k=null,x=0;const p={};for(const e of Object.keys(t||{})){let o=0,i=0;for(const l of Object.values(t[e]||{}))o+=l.time||0,i+=l.count||0,l.category&&l.category!=="Misc / Uncategorized"&&l.category!=="miscellaneous"&&(p[l.category]||(p[l.category]=0),p[l.category]+=l.time||0);a.perDay[e]={seconds:o,minutes:Math.floor(o/60),tabs:i},d+=o,c+=i,o/60>x&&(x=Math.floor(o/60),k=e)}a.totalSeconds=d,a.totalMinutes=Math.floor(d/60),a.totalTabs=c,a.highestDay=k,a.highestMinutes=x,a.categoryTotals=p,a.categoryPercents=Object.entries(p).filter(([e])=>e!=="Misc / Uncategorized"&&e!=="miscellaneous").map(([e,o])=>({cat:e,sec:o,hrs:Math.round(o/3600),pct:d?o/d*100:0})).sort((e,o)=>o.sec-e.sec);const g=a.categoryPercents.filter(e=>e.cat!=="Misc / Uncategorized"&&e.cat!=="miscellaneous").slice(0,5).map(e=>e.cat),u={};for(const e of g)e==="Misc / Uncategorized"||e==="miscellaneous"||(u[e]=[]);for(const e of Object.keys(t||{}))for(const[o,i]of Object.entries(t[e]||{}))g.includes(i.category)&&i.category!=="Misc / Uncategorized"&&i.category!=="miscellaneous"&&u[i.category].push({title:i.title||o,time:i.time||0,url:o});a.categorySummaries={};for(const e of g)if(!(e==="Misc / Uncategorized"||e==="miscellaneous")){u[e]=u[e].sort((o,i)=>i.time-o.time).slice(0,100),a.topCategoryWebsites[e]=u[e].map(o=>o.title),console.log("Top pages for category",e,":",a.topCategoryWebsites[e]);try{console.log("Summarizing category:",e);const o=await window.Summarizer.create({type:"tldr",format:"plain-text",length:"short",sharedContext:`Summarize the user's behavior in the category '${e}' from the following top 100 pages. Strictly keep it under 100 words.`}),i=u[e].map((f,m)=>`${m+1}. ${f.title} (${f.time} seconds)`).join(`
`),h=`User description: ${s?.description||""}
Top 100 pages in category '${e}':
${i}`,y=await o.summarize(h);a.categorySummaries[e]=y}catch(o){console.log("Error summarizing category",e,":",o),a.categorySummaries[e]="Summary unavailable."}}a.topCategoryStreaks={};for(const e of g){if(e==="Misc / Uncategorized"||e==="miscellaneous")continue;let o=[];const i={};for(const h of Object.keys(t||{})){let y=0;for(const f of Object.values(t[h]||{}))f.category===e&&(y+=f.time||0);i[h]=y}const l=Object.keys(i).sort();if(l.length>0){const h=new Date(l[0]),y=new Date(l[l.length-1]),f=[];for(let n=new Date(h);n<=y;n.setDate(n.getDate()+1)){const v=n.toISOString().slice(0,10);f.push(v)}const m=f.map(n=>({date:n,minutes:i[n]||0}));let E=-1,T=0;for(let n=0;n<=m.length-7;n++){const v=m.slice(n,n+7).reduce((G,_)=>G+_.minutes,0);v>E&&(E=v,T=n)}o=m.slice(T,T+7).map(n=>({date:n.date,seconds:n.minutes}))}else o=[];a.topCategoryStreaks[e]=o,(e==="Work and Professional"||e==="Work and Learning")&&(a.workStreak=o),console.log(`Streak for ${e}:`,o)}await U({tabWrapSummary:a}),console.log("Tab Wrap summary calculated!")}async function w(t=!1){const{db:s,profile:a}=await $(["db","profile"]);if(!window.LanguageModel){console.log("LanguageModel API not available");return}if(await LanguageModel.availability()==="unavailable"){console.log("Gemini Nano not available");return}const c=await LanguageModel.create(),k=a?.description||"",x=(a?.categories||[]).map(g=>typeof g=="string"?g:g.text);let p=!1;for(const g of Object.keys(s||{}))for(const[u,e]of Object.entries(s[g]||{}))if(t||!e.category){console.log("Checking entry for URL:",u,"Current category:",e.category);const o=`User description: ${k}
Categories: ${x.join(", ")}
URL: ${u}
Title: ${e.title}

Based on the above, which category was the user spending time on?
Strictly output only one category from the list above. If none match, output 'miscellaneous'.`;console.log("Asking model with prompt:",o);try{const i=await c.prompt(o);e.category=i.trim(),p=!0}catch{e.category="error",p=!0}}c.destroy(),p?await U({db:s}):console.log("No entries found.")}return r.jsxs("div",{style:{minHeight:"100vh",padding:32,background:"#111",boxSizing:"border-box",position:"relative",fontFamily:"Inter, Arial, sans-serif",display:"flex",justifyContent:"center",alignItems:"flex-start"},children:[r.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:0,pointerEvents:"none"},children:[r.jsx("div",{style:{position:"absolute",top:40,left:60,width:220,height:220,background:"radial-gradient(circle, #ff2d55 0%, transparent 70%)",filter:"blur(40px)",opacity:.7}}),r.jsx("div",{style:{position:"absolute",top:120,right:40,width:180,height:180,background:"radial-gradient(circle, #a259ff 0%, transparent 70%)",filter:"blur(40px)",opacity:.6}}),r.jsx("div",{style:{position:"absolute",bottom:40,left:120,width:160,height:160,background:"radial-gradient(circle, #2ecc40 0%, transparent 70%)",filter:"blur(40px)",opacity:.5}})]}),r.jsxs("div",{style:{maxWidth:700,width:"100%"},children:[r.jsx("h2",{style:{color:"#fff",fontWeight:800,fontSize:36,letterSpacing:1,marginBottom:18,textAlign:"center",textShadow:"0 2px 12px #a259ff, 0 1px 4px #ff2d55"},children:"Tab Wrap Options"}),r.jsxs("div",{style:{marginBottom:24},children:[r.jsxs("label",{children:[r.jsx("input",{type:"checkbox",checked:M,onChange:B})," Debug Mode"]}),M&&r.jsxs("div",{style:{marginTop:8},children:[r.jsx("label",{children:"Set Debug Date: "}),r.jsx("input",{type:"date",value:I,onChange:H,style:{marginLeft:8}})]})]}),r.jsxs("div",{style:{margin:"24px 0",background:"transparent",borderRadius:18,padding:20,color:"#fff",boxShadow:"0 4px 16px rgba(0,0,0,0.15)"},children:[r.jsx("label",{style:{fontWeight:"bold",fontSize:20,marginBottom:12,display:"block",letterSpacing:1},children:"Tell us about yourself:"}),r.jsx("textarea",{value:C.description,onChange:t=>D({...C,description:t.target.value}),style:{width:"100%",minHeight:60,background:"transparent",color:"#fff",border:"none",fontSize:16,fontFamily:"inherit",outline:"none",resize:"vertical"},placeholder:"Share a bit about your work, interests, or browsing habits..."})]}),r.jsxs("div",{style:{margin:"24px 0",background:"transparent",borderRadius:18,padding:20,color:"#fff",boxShadow:"0 4px 16px rgba(0,0,0,0.15)"},children:[r.jsx("label",{style:{fontWeight:"bold",fontSize:20,marginBottom:12,display:"block",letterSpacing:1},children:"Categories (click to select):"}),r.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"14px"},children:S.map((t,s)=>{const a=t.emoji,d=t.text,c=j.includes(d);return r.jsxs("span",{onClick:()=>L(t),style:{background:c?"#fff":"#f3f3f3",color:c?"#222":"#444",borderRadius:14,padding:"10px 18px",fontSize:17,display:"flex",alignItems:"center",boxShadow:c?"0 2px 12px rgba(0,0,0,0.10)":"0 2px 8px rgba(0,0,0,0.08)",border:c?"2px solid #4f8cff":"1px solid #eee",minWidth:90,justifyContent:"center",cursor:"pointer",opacity:c?1:.85,transition:"all 0.2s",userSelect:"none",fontWeight:c?600:400,letterSpacing:.5},title:c?"Included in analytics":"Excluded from analytics",children:[a&&r.jsx("span",{style:{fontSize:24,marginRight:10},children:a}),d]},d+s)})})]}),r.jsxs("div",{style:{marginTop:32},children:[r.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap",marginBottom:18},children:[r.jsx("button",{style:{background:"white",color:"rgb(255, 90, 46)",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(46,204,64,0.12)",cursor:"pointer"},onClick:A,children:"Save Profile"}),r.jsx("button",{style:{background:"white",color:"rgb(255, 90, 46)",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(162,89,255,0.12)",cursor:"pointer"},onClick:F,children:"Clear Profile"}),r.jsx("button",{style:{background:"white",color:"rgb(255, 90, 46)",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(79,140,255,0.12)",cursor:"pointer"},onClick:()=>w(!1),children:"Categorize"}),r.jsx("button",{style:{background:"white",color:"rgb(255, 90, 46)",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(255,45,85,0.12)",cursor:"pointer"},onClick:N,children:"Tab Wrap"})]}),r.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap",marginTop:18},children:[r.jsx("button",{style:{background:"linear-gradient(90deg, #232526 0%, #414345 100%)",color:"#fff",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(0,0,0,0.12)",cursor:"pointer"},onClick:()=>chrome.storage.local.set({db:{}},()=>P({})),children:"Clear DB"}),r.jsx("button",{style:{background:"linear-gradient(90deg, #232526 0%, #ff2d55 100%)",color:"#fff",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(255,45,85,0.12)",cursor:"pointer"},onClick:()=>chrome.storage.local.set({historyPaused:!0},()=>z(!0)),children:"Pause History"}),r.jsx("button",{style:{background:"linear-gradient(90deg, #232526 0%, #2ecc40 100%)",color:"#fff",border:"none",borderRadius:12,padding:"10px 24px",fontWeight:600,fontSize:16,boxShadow:"0 2px 8px rgba(46,204,64,0.12)",cursor:"pointer"},onClick:()=>chrome.storage.local.set({historyPaused:!1},()=>z(!1)),children:"Resume History"})]})]}),r.jsx("div",{style:{marginTop:32,display:"flex",justifyContent:"center"},children:r.jsx("button",{style:{background:"linear-gradient(90deg, #ff2d55 0%, #232526 100%)",color:"#fff",border:"none",borderRadius:12,padding:"12px 32px",fontWeight:700,fontSize:18,boxShadow:"0 2px 8px rgba(255,45,85,0.18)",cursor:"pointer",marginTop:24},onClick:()=>window.location.href="test_page.html",children:"Go to Test Page"})})]})]})}const K=document.getElementById("root");q.createRoot(K).render(r.jsx(J,{}));
